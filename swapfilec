#!/bin/bash
#---------------------------------------------------------------------------------------------------------------#
# swapfile creation/deletion utlity                                                                                      #
# This script is licenced under GPLv3 ; you can get your copy from https://www.gnu.org/licenses/gpl-3.0.en.html #
# (C) Omkar Dhekne ; ogdhekne@yahoo.in ; github: https://github.com/ogdhekne                                    #
#---------------------------------------------------------------------------------------------------------------#

# Environment variables:
  location="$2"
  size="$3"

# Functions:

  # Create Swapfile
  create()
  {
  # dd if=/dev/zero of=$location bs=1 count=0 seek=$size # deleted this line as not compatible with debian based distro.
  
  # Below command for debian based distro.:
  fallocate -l $size $location

  chmod 0600 $location

  mkswap $location

  swapon $location

  echo "$location none            swap    sw              0       0" | tee --append /etc/fstab

  echo "vm.swappiness=100" | tee --append /etc/sysctl.conf

  echo -e "\n Kernel Parameters:"
  sysctl -p

  echo -e "\n Current Swap locations:"
  swapon -s

  echo -e "\n Memory and Swap utilization:"
  free -m

  echo -e  "\n DONE"
  }

  # Delete Swapfile.
  delete()
  {
  swapoff $location

  sed --in-place '/swap/d' /etc/fstab

  rm -rf $location

  sed --in-place '/swappiness/d' /etc/sysctl.conf

  echo -e "\n Current Swap locations:"
  swapon -s

  echo -e "\n Memory and Swap utilization:"
  free -m

  echo -e  "\n DONE"
  }

  # Print Help.
  help()
  {
  cat <<EOF
  +---------------------+
  +  Swapfile Utility:  +
  +---------------------+
  create:  $0 create <location> <size>
  delete:  $0 delete <location>
  help:    $0 help  

  Examples:
  create:  $0 create /swap 1G
  delete:  $0 delete /swap
EOF
  }

# Execute functions:
  # If no commandline argument is passed then print help.
  if [[ -z $1 ]]
  then
    help
  else
    $1
  fi
